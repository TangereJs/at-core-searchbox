<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../core-icons/core-icons.html">
<link rel="import" href="../core-icon/core-icon.html">
<link rel="import" href="../speech-mic/speech-mic.html">

<polymer-element name="at-core-searchbox" >

  <template>
    <style>
      #searchBox {
        background-color: white;
        position: relative;       
        height: 44px;
        padding: 0 4px;
        border: 1px solid rgba(0, 0, 0, 0.16);
        margin:0 auto;
        max-width:500px;
      }
      
      #searchInput {
        margin: 0 1px;
        border: 0;
        font-size: 16px;
        outline: none;
      }
      
      #searchIcon {
        padding-left: 4px;
      }
      
    </style>
    
    
    <form action="#" method="get" onsubmit="event.preventDefault()">
      <div id="searchBox" center horizontal layout>
        <core-icon id="searchIcon" icon="search"></core-icon>
        <input id="searchInput" flex on-blur="{{termChange}}" on-keypress="{{keyPress}}" value="{{ _valueNew }}" type="search" placeholder="{{ placeholder }}">
        <speech-mic id="speech" on-speech-mic-result="{{speechResult}}" language="{{ language }}"></speech-mic>
      </div>
      </form>

</template>

  <script>

    Polymer('at-core-searchbox', {

      publish: {        
        searchTerm: { value: '', reflect: true },
        placeholder: { value: '', reflect: true },
        language: { value: 'en-US', reflect: true},
        _valueNew: ''	  
      },
      
      keyPress: function(e) {
        // enter was hit
        if(e.keyCode == 13)  {this.termChange();}
      },
      
      searchTermChanged: function() {
        if(this._valueNew != this.searchTerm)  this._valueNew = this.searchTerm;
      },
      
      termChange: function () {
        this.$.searchInput.blur();
        this.searchTerm = this._valueNew;
      },
      
      speechResult: function(e) {
        
        // update input field with speech value
        this._valueNew = e.detail.transcript;
        
        // when detection isFinal then report new term
        if(e.detail.isFinal) { this.termChange(); } 
      },
      
      ready: function() {
      }

    });

  </script>

</polymer-element>
